Use Subqueries

Challenge 1: Retrieve product price information
Adventure Works products each have a standard cost price that indicates the cost of manufacturing the product, and a list price that indicates the recommended selling price for the product. This data is stored in the SalesLT.Product table. Whenever a product is ordered, the actual unit price at which it was sold is also recorded in the SalesLT.SalesOrderDetail table. You must use subqueries to compare the cost and list prices for each product with the unit prices charged in each sale.

1. Retrieve products whose list price is higher than the average unit price.
Retrieve the product ID, name, and list price for each product where the list price is higher than the average unit price for all products that have been sold.

-its scalar because im comparing one unit price with one list price 
-Its self-contained because the inner query does not need to reference values from the outer query 

Listprice comes from Product table
UnitPrice comes from SalesOrderDetail table

SELECT
  productID,
  Name,
  ListPrice
FROM
  SalesLT.Product
WHERE
ListPrice >
(SELECT AVG(Unitprice)
FROM SalesLT.SalesOrderDetail)

2. 
-Retrieve Products with a list price of 100 or more that have been sold for less than 100.
-Retrieve the product ID, name, and list price for each product where the list price is 100 or more, and the product has been sold for less than 100.

-Retrieve productID, name, and listprice
-Product has listprice >= 100
-Product has at least one sale with UnitPrice < 100 

the subquery is correlated because the inner query references the outer query, making it dependent 


SELECT
  productID,
  Name,
  ListPrice
FROM
  SalesLT.Product AS p
WHERE
  ListPrice >= 100
AND EXISTS
(SELECT 1
FROM SalesLT.SalesOrderDetail AS s
WHERE 
p.ProductID = s.ProductID AND
UnitPrice < 100
)


Challenge 2: Analyze profitability
The standard cost of a product and the unit price at which it is sold determine its profitability. You must use correlated subqueries to compare the cost and average selling price for each product.

1. 
Retrieve the cost, list price, and average selling price for each product
Retrieve the product ID, name, cost, and list price for each product along with the average unit price for which that product has been sold.

To connect the product with its selling price in a seperate table inside the subquery it needs to be correlated 

The inner query returns one avg unit price per product to the outer query so its scalar 

-Retrieve product id, name, cost, list price, and average selling price for each product 
-average UnitPrice for which that product has been sold

SELECT
  productID,
  Name,
  StandardCost,
  ListPrice,
  (SELECT AVG(UnitPrice)
  FROM SalesLT.SalesOrderDetail AS s
  WHERE s.ProductID = p.ProductID  
  ) AS average_unit_price
FROM
  SalesLT.Product AS p

3. 
Retrieve products that have an average selling price that is lower than the cost.
Filter your previous query to include only products where the cost price is higher than the average selling price.

SELECT
  ProductID,
  Name,
  StandardCost,
  ListPrice,
  (SELECT AVG(UnitPrice)
  FROM SalesLT.SalesOrderDetail AS s
  WHERE s.ProductID = p.ProductID  
  ) AS average_unit_price
FROM
  SalesLT.Product AS p
WHERE
StandardCost >
(SELECT AVG(UnitPrice)
 FROM SalesLT.SalesOrderDetail AS s
WHERE s.ProductID = p.ProductID  
)

Lab Setup:
https://microsoftlearning.github.io/dp-080-Transact-SQL/Instructions/Labs/00-setup.html#microsoft-azure-data-studio



Challenge 1: Create a view
Part A: Write a Transact-SQL query to create a view for customer addresses in Canada. Create a view based on the following columns in the SalesLT.Address table: AddressLine1, City,StateProvince, CountryRegion
In your query, use the CountryRegion column to filter for addresses located in Canada only.

Requirements:
Create View 
Pull data from SalesLT.Address table
Pull columns: addressLine1, City,StateProvince, CountryRegion
filter by CountryRegion for address in canada


Views in T-SQL are saved queries that provide an alternative to referencing tables directly in future queries. 
Inside my database AdventureWork, im creating the view customer_addresses_canada

CREATE VIEW customer_addresses_canada AS
SELECT 
    AddressLine1,
    City,
    StateProvince,
    CountryRegion
FROM
    SalesLT.Address
WHERE
    CountryRegion = 'Canada'

Part B: 
Query your new view.
Fetch the rows in your newly created view to ensure it was created successfully. Notice that it only shows address in Canada.

In a separate query i write: 

SELECT *
FROM
    [dbo].[customer_addresses_canada]



Challenge 2: Use a derived table
The transportation team at Adventure Works wants to optimize its processes. Products that weigh more than 1000 are considered to be heavy products, and will also need to use a new transportation method if their list price is over 2000. Youâ€™ve been asked to classify products according to their weight, and then provide a list of products that meet both these weight and list price criteria.

Part A: Write a query that classifies products as heavy and normal based on their weight. Use the Weight column to decide whether a product is heavy or normal. 

Requirements:
Required Columns: ProductID, Name, Weight, ListPrice
Create case statements that classify products as heavy or normal based on weight over 1000

This problem didnt specify which table to use but all the information we need is stored in the product table

SELECT 
    ProductID,
    Name,
    ListPrice, 
    CASE WHEN 
        Weight > 1000 THEN 'heavy'
    ELSE
        'normal'
    END AS 
        Weight_type
FROM
    SalesLT.Address




Part B: Create a derived table based on your query Use your derived table to find any heavy products with a list price over 2000. Make sure to select the following columns: ProductID, Name, Weight, ListPrice.

Requirements:
-I need to use a derived table to filter my outer query for heavy products with a list price over 2000.


Attempt 1: 
I forgot the execution order of sql. FROM, WHERE, SELECT. When WHERE runs, its looking for Weight_type that hasnt been created yet. So I will run the filter for Weight_type after its created in the CTE 

Question: Does the CTE run first before the outer query? Does SELECT run first in the CTE before WHERE in the Outer Query?

WITH heavyproducts_over2k AS(
    SELECT 
        ProductID,
        Name,
        Weight,
        ListPrice,
        CASE WHEN 
            Weight > 1000 THEN 'heavy'
        ELSE
            'normal'
        END AS 
            Weight_type
    FROM
       SalesLT.Product
    WHERE
        ListPrice > 2000 AND Weight_type = 'heavy'

)


SELECT *
FROM 
    heavyproducts_over2k




SOLUTION:
I noticed that the solution used N'' for the strings. 

WITH heavyproducts_over2k AS(
    SELECT 
        ProductID,
        Name,
        Weight,
        ListPrice,
        CASE WHEN 
            Weight > 1000 THEN 'heavy'
        ELSE
            'normal'
        END AS 
            Weight_type
    FROM
       SalesLT.Product
    WHERE
        ListPrice > 2000

)
SELECT *
FROM 
    heavyproducts_over2k
 WHERE
    Weight_type = 'heavy'